dist: xenial
language: bash
addons:
  apt:
    packages:
    - aria2
    - zip
    - unzip
before_script:
- sudo apt-get update -qq
- sudo apt-get install aria2 zip unzip check -qq
script:
- source ./env.sh
- "${DLR} ${ROOTFS_URL} -o ${ROOTFS_TGZ}"
- "${DLR} ${LNCR_URL} -o ${LNCR_ZIP}"
- 
- unzip ${LNCR_ZIP} ${LNCR_FN}
- sudo tar -zxpf ${ROOTFS_TGZ}
- 
- sudo losetup --partscan /dev/loop0 ${ROOTFS_FN}
- sudo mkdir mntfs
- sudo mount -o ro /dev/loop0p1 mntfs
- sudo cp -a mntfs rootfs
- sudo umount mntfs
- 
- echo "# This file was automatically generated by WSL. To stop automatic generation
  of this file, remove this line." | sudo tee ./rootfs/etc/resolv.conf
- 
- cd rootfs
- sudo tar -zcpf ../rootfs.tar.gz *
- sudo chown `id -un` ../rootfs.tar.gz
- cd ..
- 
- mkdir out
- mkdir dist
- mv -f ${LNCR_FN} ./out/${LNCR_ZIPFN}
- mv -f rootfs.tar.gz ./out/
- cd out
- zip ../dist/CentOS${OS_VER}.zip *
- cd ..
notifications:
  email: false
deploy:
  provider: releases
  api_key:
    secure: dTL+wUJIEs7DSOAkbxN8FkRE+S0rmUmZ9OUsy+tKjOk0Xv6FLc+ong1kUbnwcUn7NMH3tOtO7LiKZYcfX3wS7vK4QtyIIh4ZO2b5Wuhb/Gg6HqLYjXpjvYPk8uLK355nCrsIx40nJ7gDvdyybCVX71yKLahp8EEAkmvaQY/UiWNQxmsTbmVOwPlQbVRLSjfpX9EMq8eiXPc+AvYTs7IhWQ/6BaJQKXVtu7ejGNWHGwm8YiJ1j2VQb+J9Fbxt7KNkPrHh4wkNkohlmiqmCh64MuZPV1xjaXZ+VZNxB8mgqtsIZ0Tbi4UdYSeZDA/9crFy5mulI7WrZTNPBgVaa8aQgZWyw+4wSswTIwuBmACqpHt4j3JxKoELUIBI1UunIgwG0CCYVyJViQxEc2z0KM0XFaFv63lfcPUJv4AKMd1M3Zi3tC4rG3ZaFb2tRH3YjN9cYBj4PZKoYwJN41uc5qFGqM3LOFMtRtSrEjBGi9ICFirVdhPvMse9oeVaCfzUouTAKBQ9n8cs+5qmL3wmyQEAsT4iwrEqoVwSIK8V7pIss5k8Pocnr2kwLCUKvd5ZB5p3XdbWJx/5DesR6J7+sb+UWzTeQt2cRJN/V6f3kQr3KhCuM0QICqjP+iMh4DBpViQZecJkTFLgrlyr1cEpfz55otMe5AWDA/y8/TNzk3BvFnI=
  file: CentOS.zip
  on:
    repo: bytesapart/CentWSL
    branch: '7'
